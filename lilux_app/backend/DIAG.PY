def diagnostic_complet():
    """Test complet de diagnostic"""
    import requests
    import time
    import hmac
    import hashlib
    import urllib.parse
    from config import Config
    
    print("ğŸ©º DIAGNOSTIC COMPLET BINANCE API")
    print("=" * 50)
    
    # 1. Test de connectivitÃ© basique
    print("1. ğŸ”Œ Test connectivitÃ© rÃ©seau...")
    try:
        response = requests.get("https://api.binance.com/api/v3/ping", timeout=10)
        print(f"   âœ… Ping: {response.status_code}")
    except Exception as e:
        print(f"   âŒ Erreur rÃ©seau: {e}")
        return False
    
    # 2. Test endpoint public
    print("2. ğŸ“¡ Test endpoint public...")
    try:
        response = requests.get("https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT", timeout=10)
        if response.status_code == 200:
            data = response.json()
            print(f"   âœ… Prix BTC: {data.get('price')}")
        else:
            print(f"   âŒ Erreur: {response.status_code} - {response.text}")
    except Exception as e:
        print(f"   âŒ Erreur: {e}")
    
    # 3. VÃ©rification clÃ©s
    print("3. ğŸ”‘ VÃ©rification clÃ©s API...")
    print(f"   API Key: {Config.BINANCE_API_KEY[:20]}... ({len(Config.BINANCE_API_KEY)} chars)")
    print(f"   Secret: {Config.BINANCE_API_SECRET[:20]}... ({len(Config.BINANCE_API_SECRET)} chars)")
    
    # 4. Test signature manuelle
    print("4. ğŸ–‹ï¸ Test signature manuelle...")
    try:
        timestamp = int(time.time() * 1000)
        query_string = f"timestamp={timestamp}"
        
        signature = hmac.new(
            Config.BINANCE_API_SECRET.encode('utf-8'),
            query_string.encode('utf-8'),
            hashlib.sha256
        ).hexdigest()
        
        print(f"   âœ… Signature gÃ©nÃ©rÃ©e: {signature[:20]}...")
        
        # Test avec la requÃªte la plus simple
        url = f"https://api.binance.com/api/v3/account?{query_string}&signature={signature}"
        headers = {'X-MBX-APIKEY': Config.BINANCE_API_KEY}
        
        response = requests.get(url, headers=headers, timeout=10)
        print(f"   ğŸ“¡ Response: {response.status_code} - {response.text}")
        
        if response.status_code == 200:
            print("   ğŸ‰ SUCCÃˆS! Les clÃ©s fonctionnent!")
            return True
        else:
            print("   âŒ Ã‰CHEC! Les clÃ©s sont invalides")
            return False
            
    except Exception as e:
        print(f"   âŒ Erreur test: {e}")
        return False

# ExÃ©cutez ce test
diagnostic_complet()